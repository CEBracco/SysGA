{% extends 'base.html.twig' %}

{% block defaultBody %}
{{ form_start(form) }}

<div class="row">
    <div class="col s10 offset-s1">
        <div class="card-panel">
            {% if edit is not defined or edit == false %}
                <h4 class="title">Nuevo Trámite</h4>
            {% else %}
                <h4 class="title">Editar Trámite</h4>
            {% endif %}

            <div class="row">
                <div class="col m6">
                    <div class="input-field">
                        {{ form_widget(form.codigoInternoConcesionaria) }}
                        {{ form_label(form.codigoInternoConcesionaria) }}
                    </div>
                </div>
                <div class="col m6">
                    <div class="input-field">
						{% if edit is not defined or edit == false %}
                        	{{ form_widget(form.fecha, {'attr': {'class': 'datepicker'}}) }}
						{% else %}
							{{ form_widget(form.fecha, {'attr': {'class': 'datepickerEmpty'}}) }}
						{% endif %}
                        {{ form_label(form.fecha) }}
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col m6">
                    <div class="input-field">
                        {{ form_widget(form.concesionaria) }}
                        {{ form_label(form.concesionaria) }}
                    </div>
                </div>
                <div class="col m6">
                    <div class="input-field">
                        {{ form_widget(form.registroDelAutomotor) }}
                        {{ form_label(form.registroDelAutomotor) }}
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="row">
    <div class="col s10 offset-s1">
        <div class="card-panel">
            <h5 class="title">Titular</h5>
			<div class="row">
				<div class="col m6">
					<div class="input-field">
						{{ form_widget(form.dniTitular, { 'type':'number' }) }}
						{{ form_label(form.dniTitular) }}
					</div>
				</div>
				<div class="col m6">
					<div class="input-field">
						{{ form_widget(form.provinciaTitular) }}
						{{ form_label(form.provinciaTitular) }}
					</div>
				</div>
			</div>

            <div class="row">
                <div class="col m6">
                    <div class="input-field">
                        {{ form_widget(form.nombreTitular) }}
                        {{ form_label(form.nombreTitular) }}
                    </div>
                </div>
                <div class="col m6">
                    <div class="input-field">
                        {{ form_widget(form.apellidoTitular) }}
                        {{ form_label(form.apellidoTitular) }}
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="row">
    <div class="col s10 offset-s1">
        <div class="card-panel">
            <h5 class="title">Depositos</h5>
            <div class="row">
                <div class="col m12">
					<div class="row">
						<div class="input-field">
							{{ form_widget(form.depositoEnRegistro, {'attr': {'class': 'numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } }) }}
							{{ form_label(form.depositoEnRegistro) }}
						</div>
					</div>

					{% if tramite.depositos is not empty %}
						<div class="row">
							<ul class="collection with-header">
								<li class="collection-header teal darken-3"><h6 class="white-text">Depositos Realizados</h6></li>
								{% for deposito in tramite.depositos %}
									<li class="collection-item">{{ deposito.fecha|date('d/m/Y') }} - ${{ deposito.monto|number_format(2, ',', '.') }}</li>
								{% endfor %}
							</ul>
						</div>
					{% endif %}

					{% if edit is defined and edit == true %}
					<p class="center-align"><b>Total depositado en Registro:</b> ${{ tramite.getTotalDepositadoEnRegistro}}</p>
					{% endif %}
                </div>

				{#
                <div class="col m6">
                    <div class="input-field">
                        {{ form_widget(form.depositoGestoria, {'attr': {'class': 'numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } }) }}
                        {{ form_label(form.depositoGestoria) }}
                    </div>
					{% if edit is defined and edit == true %}
					<p class="center-align"><b>Total depositado en Gestoria:</b> ${{ tramite.getTotalDepositadoGestoria}}</p>
					{% endif %}
                </div>
				#}

            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col s10 offset-s1">
        <div class="card-panel">
            <h5 class="title">Gastos</h5>
            <div class="row">
                <div class="col m2">
                    <div class="input-field">
                        {{ form_widget(form.gastoArancel, {'attr': {'class': 'totalEnRegistro numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } }) }}
                        {{ form_label(form.gastoArancel) }}
                    </div>
                </div>

                <div class="col m2">
                    <div class="input-field">
                        {{ form_widget(form.impuestosPatente, {'attr': {'class': 'totalEnRegistro numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } }) }}
                        {{ form_label(form.impuestosPatente) }}
                    </div>
                </div>

                <div class="col m2">
                    <div class="input-field">
                        {{ form_widget(form.selladosRegistro, {'attr': {'class': 'totalEnRegistro numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } } ) }}
                        {{ form_label(form.selladosRegistro) }}
                    </div>
                </div>

                <div class="col m2">
                    <div class="input-field">
                        {{ form_widget(form.selladosGestoria, {'attr': {'class': 'totalGestoria numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } } ) }}
                        {{ form_label(form.selladosGestoria) }}
                    </div>
                </div>

                <div class="col m2">
                    <div class="input-field">
                        {{ form_widget(form.honorarios, {'attr': {'class': 'totalGestoria numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } }) }}
                        {{ form_label(form.honorarios) }}
                    </div>
                </div>

                <div class="col m2">
                    <div class="input-field">
                        {{ form_widget(form.otros, {'attr': {'class': 'totalGestoria numberInput', 'pattern':'[0-9]+([,\.][0-9]+)?' } }) }}
                        {{ form_label(form.otros) }}
                    </div>
                </div>
            </div>

            {% set totalEnRegistro = form.vars.value.gastoArancel + form.vars.value.impuestosPatente + form.vars.value.selladosRegistro %}
            {% set totalGestoria = form.vars.value.selladosGestoria + form.vars.value.honorarios + form.vars.value.otros %}

            <div class="row">
                <div class="col m6 center-align">
                    <b>Total en registro: </b>
                    $<span class="showTotalEnRegistro">{{ totalEnRegistro }}</span>
                </div>
                <div class="col m6 center-align">
                    <b>Total gestoría: </b>
                    $<span class="showTotalGestoria">{{ totalGestoria }}</span>
                </div>
            </div>

            <div class="row">
                <div class="col m12 center-align">
                    <h5>
                        <b>Total: </b>
                        $<span class="showTotal">{{ totalEnRegistro + totalGestoria }}</span>
                    </h6>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="row">
    <div class="center-align">
        <button class="btn waves-effect waves-light" type="submit"><i class="material-icons left">save</i>Guardar</button>
        <a href="{{ path('tramite_index') }}"><button type="button" class="btn-flat waves-effect waves-light">Cancelar</button></a>
    </div>
</div>
{{ form_end(form) }}
{% endblock %}


{% block javascripts %}
<script type="text/javascript">
    var totalEnRegistro=0;
    var totalGestoria=0;
    var total=0;

    $(document).ready(function(){
        initValues();

        $('.totalEnRegistro').on('change keyup',function(){
            totalEnRegistro=0;
            $.each($('.totalEnRegistro'),function(index, totalIngresado){
                if(total.value != ''){
                    totalEnRegistro = totalEnRegistro + getValue(totalIngresado.value);
                    total=totalEnRegistro + totalGestoria;
                }
            });
            $('.showTotalEnRegistro').text(totalEnRegistro);
            $('.showTotal').text(round(parseFloat(total)));
        });

        $('.totalGestoria').on('change keyup',function(){
            totalGestoria=0;
            $.each($('.totalGestoria'),function(index, totalIngresado){
                if(total.value != ''){
                    totalGestoria = totalGestoria + getValue(totalIngresado.value);
                    total=totalEnRegistro + totalGestoria;
                }
            });
            $('.showTotalGestoria').text(totalGestoria);
            $('.showTotal').text(round(parseFloat(total)));
        });

    });

    function getValue(value){
        var integerVal=parseFloat(value);
        if(isNaN(integerVal)){
            return 0;
        }
        return integerVal;
    }

    function initValues(){
        $.each($('.totalGestoria'),function(index, totalIngresado){
            totalGestoria = totalGestoria + getValue(totalIngresado.value);
        });
        $.each($('.totalEnRegistro'),function(index, totalIngresado){
            totalEnRegistro = totalEnRegistro + getValue(totalIngresado.value);
        });
    }
</script>
{% endblock %}
